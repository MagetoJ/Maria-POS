# POS Mocha - Fullstack Render Deployment Guide

## Overview
This project is now configured as a **single fullstack service** on Render that serves both the API backend and React frontend from one Node.js application.

## Architecture
- **Backend**: Node.js + Express (serves API endpoints)
- **Frontend**: React + Vite (built to static files)
- **Database**: SQLite (embedded)
- **Deployment**: Single Render web service

## Deployment Configuration

### render.yaml Configuration
```yaml
services:
  - type: web
    name: pos-mocha-fullstack
    env: node
    buildCommand: |
      # Install and build frontend
      npm ci
      RENDER=true npm run build:render
      # Install and build backend  
      cd server
      npm ci
      npm run build
    startCommand: cd server && npm start
    healthCheckPath: /health
```

### Build Process
1. **Frontend Build**: 
   - Installs dependencies with `npm ci`
   - Builds React app to `./dist/client/` using Vite
   - Sets `RENDER=true` for production optimizations

2. **Backend Build**:
   - Installs server dependencies in `./server/`
   - Compiles TypeScript to `./server/dist/`
   - Sets up database and runs migrations

### File Serving Strategy
The backend serves:
- **API routes**: `/api/*` endpoints
- **Static files**: Frontend assets from `./dist/client/`
- **SPA fallback**: `index.html` for all non-API routes

## Environment Variables

### Required
- `NODE_ENV=production`
- `JWT_SECRET` (auto-generated by Render)
- `PORT=10000`

### Optional
- `FRONTEND_URL` (for CORS - should be your Render domain)

## Local Development

### Start Backend Only
```bash
cd server
npm run dev
```

### Start Frontend Only  
```bash
npm run dev
```

### Build for Production
```bash
# Build frontend
npm run build:render

# Build backend
cd server
npm run build
```

### Test Fullstack Locally
```bash
# Build both
npm run build:render
cd server && npm run build

# Start server (serves both API + frontend)
cd server && npm start
```

## Deployment Steps

### Initial Deployment
1. **Connect Repository**: Link your GitHub repo to Render
2. **Create Web Service**: Use the `render.yaml` configuration
3. **Environment Variables**: Set required variables in Render dashboard
4. **Deploy**: Trigger initial build and deployment

### Updates
1. **Push to GitHub**: Commit changes to your repository
2. **Auto Deploy**: Render will automatically build and deploy (if enabled)
3. **Manual Deploy**: Trigger manual deployment from Render dashboard

## URLs After Deployment
- **Full Application**: `https://your-service-name.onrender.com`
- **API Endpoints**: `https://your-service-name.onrender.com/api/*`
- **Health Check**: `https://your-service-name.onrender.com/health`

## File Structure
```
pos-mocha/
├── src/react-app/          # Frontend React source
├── dist/client/            # Built frontend files
├── server/
│   ├── src/               # Backend TypeScript source
│   ├── dist/              # Built backend files
│   └── database/          # SQLite database
├── render.yaml            # Render deployment config
└── package.json           # Frontend dependencies
```

## Troubleshooting

### Build Failures
- Check build logs in Render dashboard
- Ensure all dependencies are in package.json
- Verify TypeScript compilation passes locally

### Runtime Issues  
- Check application logs in Render dashboard
- Verify database file permissions
- Ensure static files are being served correctly

### CORS Issues
- Update FRONTEND_URL environment variable
- Check CORS configuration in server/src/index.ts

## Performance Notes
- Static assets are served with caching headers
- Database is embedded SQLite (no external DB required)
- Single service reduces complexity and costs
- Frontend assets are optimized with Vite build